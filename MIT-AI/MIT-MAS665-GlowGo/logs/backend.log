INFO:     Will watch for changes in these directories: ['/home/vitaly/MIT-MAS665-GlowGo/MIT-AI/MIT-MAS665-GlowGo/glowgo-backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [167404] using WatchFiles
INFO:     Started server process [167544]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
üöÄ GlowGo Backend Starting...
üìä Database: aws-0-us-west-2.pooler.supabase.com:6543/postgres
INFO:     127.0.0.1:56300 - "OPTIONS /api/auth/google-login HTTP/1.1" 200 OK
INFO:     127.0.0.1:56300 - "POST /api/auth/google-login HTTP/1.1" 200 OK
INFO:     127.0.0.1:56300 - "OPTIONS /api/calendar/events HTTP/1.1" 200 OK
INFO:     127.0.0.1:56308 - "OPTIONS /api/calendar/events HTTP/1.1" 200 OK
INFO:     127.0.0.1:56308 - "GET /api/calendar/events HTTP/1.1" 200 OK
INFO:     127.0.0.1:56300 - "GET /api/calendar/events HTTP/1.1" 200 OK
INFO:     127.0.0.1:43562 - "OPTIONS /api/preferences/chat HTTP/1.1" 200 OK
BrightData scraping error: Client error '401 Unauthorized' for url 'https://api.brightdata.com/request'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

[ConversationAgent] Step 1: Parsing intent from message: 'I want haircut next week on Monday. Up to 60$. In Boston area.'
[ConversationAgent] Current preferences before intent parsing: {'service_type': None, 'budget_min': None, 'budget_max': None, 'time_urgency': None, 'preferred_date': None, 'preferred_time': None, 'time_constraint': None, 'artisan_preference': None, 'special_notes': None}
[ConversationAgent] Intent result: {'service_type': 'haircut', 'confidence': 0.95}
[ConversationAgent] Updated service_type to: haircut
[ConversationAgent] Current preferences after intent parsing: {'service_type': 'haircut', 'budget_min': None, 'budget_max': None, 'time_urgency': None, 'preferred_date': None, 'preferred_time': None, 'time_constraint': None, 'artisan_preference': None, 'special_notes': None}

[ConversationAgent] Step 2: Extracting preferences

[PreferenceExtractor] Processing message: 'I want haircut next week on Monday. Up to 60$. In Boston area.'
[DateTimeExtractor] Processing text: 'I want haircut next week on Monday. Up to 60$. In Boston area.'
[DateTimeExtractor] After time word conversion: 'i want haircut next week on monday. up to 60$. in boston area.'
[DateTimeExtractor] Found monday ‚Üí date: 2025-12-01 (days_ahead: 3, is_next_week: True)
[DateTimeExtractor] Final result: {'preferred_date': '2025-12-01', 'preferred_time': None, 'time_constraint': None}
[PreferenceExtractor] Extracted: {'budget_min': 0.0, 'budget_max': 60.0, 'time_urgency': 'week', 'preferred_date': '2025-12-01', 'location': 'Boston'}
[ConversationAgent] Preference result: {'budget_min': 0.0, 'budget_max': 60.0, 'time_urgency': 'week', 'artisan_preference': None, 'special_notes': None, 'preferred_date': '2025-12-01', 'preferred_time': None, 'time_constraint': None, 'location': 'Boston'}
[ConversationAgent] Merged extracted_preferences: {'service_type': 'haircut', 'budget_min': 0.0, 'budget_max': 60.0, 'time_urgency': 'week', 'artisan_preference': None, 'special_notes': None, 'preferred_date': '2025-12-01', 'preferred_time': None, 'time_constraint': None, 'location': 'Boston'}

[ConversationAgent] Step 3: Checking readiness

[ReadinessDetector] Checking preferences:
  service_type: haircut
  budget: 60.0
  time_urgency: week
  preferred_date: 2025-12-01
  preferred_time: None
  time_constraint: None
  location: Boston
  has_time_info: True
[ReadinessDetector] Result: ready_to_match=True, missing_fields=[]

[ConversationAgent] Readiness result: {'ready_to_match': True, 'missing_fields': [], 'completeness': 0.8}
[ConversationAgent] Ready to match: True, Missing: []

[ConversationAgent] Ready to match! Triggering live search...
[ConversationAgent] Refined location: Boston, MA, USA
[ConversationAgent] Found 6 providers
[ConversationAgent] Saved/Updated 6 providers to database

[ConversationAgent] Final result: {'extracted_preferences': {'service_type': 'haircut', 'budget_min': 0.0, 'budget_max': 60.0, 'time_urgency': 'week', 'artisan_preference': None, 'special_notes': None, 'preferred_date': '2025-12-01', 'preferred_time': None, 'time_constraint': None, 'location': 'Boston'}, 'response_to_user': 'Here are some haircut options we found for you in Boston:\n\n1. 3L Barber Co (5.0‚òÖ) - 518 Tremont St, Boston, MA 02116 [Source: Yelp]\n2. Street Salon & Barbershop (4.9‚òÖ) - 164 Newbury St, Boston, MA 02116 [Source: Yelp]\n3. S.A.S. Salon (4.8‚òÖ) - 438 Commercial St, Boston, MA 02109 [Source: Yelp]\n4. Scott Hair (4.7‚òÖ) - Boston, MA 02111 [Source: Yelp]\n5. En Salon (4.7‚òÖ) - 135 Cypress St, Brookline, MA 02445 [Source: Yelp]\n\nWe checked online sources (Google/Yelp) and updated our database. Would you like to book an appointment?', 'ready_to_match': True, 'next_question': None, 'conversation_context': 'Service: haircut | Budget: $60.0 | When: week | Location: Boston'}

üîç Step 1: Filtering by service type: haircut in Boston
‚úÖ Found 14 matching services
‚è≠Ô∏è  Step 2: Skipping location filter (no user location)
üí∞ Step 3: Filtering by budget ($0 - $60.0)
‚úÖ 7 services within budget
üìÖ Step 4: Filtering by availability (urgency: week)
‚úÖ 7 providers available
üîê Step 5: Checking provider status and quality
‚úÖ 6 high-quality providers validated
üéØ Step 6: Aggregating final candidates
üéâ Found 7 final candidates (avg quality: 0.84)
üìÖ Availability Agent: Checking 7 candidates
   Service duration: 30 minutes
   Time urgency: week

üîç Checking availability for: 3L Barber Co
   Step 1: Querying calendar...
   Found 36 potential slots
   Booked times: 0
   Step 2: Checking working hours...
   Timezone: America/New_York
   After working hours filter: 32 slots
   Step 3: Finding slots with 30 min duration...
   Slots with sufficient duration: 16
   Step 4: Validating against double-bookings...
   ‚úÖ 16 conflict-free slots

üîç Checking availability for: Street Salon & Barbershop
   Step 1: Querying calendar...
   Found 36 potential slots
   Booked times: 0
   Step 2: Checking working hours...
   Timezone: America/New_York
   After working hours filter: 36 slots
   Step 3: Finding slots with 30 min duration...
   Slots with sufficient duration: 18
   Step 4: Validating against double-bookings...
   ‚úÖ 18 conflict-free slots

üîç Checking availability for: Salon Mario Russo
   Step 1: Querying calendar...
   Found 36 potential slots
   Booked times: 0
   Step 2: Checking working hours...
   Timezone: America/New_York
   After working hours filter: 36 slots
   Step 3: Finding slots with 30 min duration...
   Slots with sufficient duration: 18
   Step 4: Validating against double-bookings...
   ‚úÖ 18 conflict-free slots

üîç Checking availability for: Court Square Styling Shop
   Step 1: Querying calendar...
   Found 36 potential slots
   Booked times: 0
   Step 2: Checking working hours...
   Timezone: America/New_York
   After working hours filter: 32 slots
   Step 3: Finding slots with 30 min duration...
   Slots with sufficient duration: 16
   Step 4: Validating against double-bookings...
   ‚úÖ 16 conflict-free slots

üîç Checking availability for: Salon Mario Russo
   Step 1: Querying calendar...
   Found 36 potential slots
   Booked times: 0
   Step 2: Checking working hours...
   Timezone: America/New_York
   After working hours filter: 36 slots
   Step 3: Finding slots with 30 min duration...
   Slots with sufficient duration: 18
   Step 4: Validating against double-bookings...
   ‚úÖ 18 conflict-free slots

üîç Checking availability for: S.A.S. Salon
   Step 1: Querying calendar...
   Found 36 potential slots
   Booked times: 0
   Step 2: Checking working hours...
   Timezone: America/New_York
   After working hours filter: 0 slots
   Step 3: Finding slots with 30 min duration...
   Slots with sufficient duration: 0
   Step 4: Validating against double-bookings...
   ‚úÖ 0 conflict-free slots

üîç Checking availability for: Scott Hair
   Step 1: Querying calendar...
   Found 36 potential slots
   Booked times: 0
   Step 2: Checking working hours...
   Timezone: America/New_York
   After working hours filter: 32 slots
   Step 3: Finding slots with 30 min duration...
   Slots with sufficient duration: 16
   Step 4: Validating against double-bookings...
   ‚úÖ 16 conflict-free slots

üìä Availability Summary:
   Providers with availability: 6
   Total available slots: 102
INFO:     127.0.0.1:43562 - "POST /api/preferences/chat HTTP/1.1" 200 OK
